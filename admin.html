<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin — MatrixMarket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="min-h-screen bg-slate-50 p-6">
    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center bg-white p-4 rounded shadow">
            <h1 class="text-xl font-bold">Admin Dashboard</h1>
            <a href="dashboard.html" class="px-4 py-2 rounded bg-slate-200">User dashboard</a>
        </div>

        <div class="mt-6 bg-white p-4 rounded shadow">
            <h2 class="font-semibold">All Users</h2>
            <div id="usersList" class="mt-3 space-y-2"></div>
        </div>
    </div>

    <script type="module">
        import { auth, db } from './firebase-init.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = 'login.html';
            // Admin check: Firestore 'admins' collection contains docs with id = uid
            const adminDoc = await getDoc(doc(db, 'admins', user.uid));
            if (!adminDoc.exists()) {
                alert('Admin access required');
                return location.href = 'dashboard.html';
            }
            const usersSnap = await getDocs(collection(db, 'users'));
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            usersSnap.forEach(u => {
                const data = u.data();
                const el = document.createElement('div');
                el.className = 'p-3 border rounded flex justify-between items-center';
                el.innerHTML = `<div><strong>${data.name || '—'}</strong><div class="text-xs text-gray-500">${data.email || '—'}</div></div><div class="text-sm text-gray-600">Role: ${data.role || 'user'}</div>`;
                usersList.appendChild(el);
            });
        });
    </script>
</body>

</html>